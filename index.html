{% extends "base.html" %}
{% block title %}Innovation Idea Tracker | {{ _('Ø§Ù„Ø£ÙÙƒØ§Ø±','Ideas') }}{% endblock %}

{% block content %}
<h2 class="mb-4 fw-bold">ğŸ’¡ {{ _('Ø§Ù„Ø£ÙÙƒØ§Ø±','Ideas') }}</h2>

{% if session.get('user_id') %}
<div class="card p-4 mb-5 shadow-sm bg-white">
  <h5 class="fw-bold mb-3">ğŸ’¡ {{ _('Ø¥Ø¶Ø§ÙØ© ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©','Add New Idea') }}</h5>
  <form method="post" enctype="multipart/form-data" id="ideaForm">
    <input name="title" class="form-control mb-3" placeholder="{{ _('Ø§Ù„Ø¹Ù†ÙˆØ§Ù†','Title') }}" required>
    <textarea name="description" class="form-control mb-2" placeholder="{{ _('Ø§Ù„ÙˆØµÙ','Description') }}" maxlength="300" id="descInput"></textarea>
    <div class="text-end mb-3"><small id="charCount">0 / 300</small></div>

    <select name="category" class="form-control mb-3" required>
      <option value="">{{ _('Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ','Select Category') }}</option>
      <option value="ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§">ğŸ–¥ {{ _('ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§','Technology') }}</option>
      <option value="ØªØ¹Ù„ÙŠÙ…">ğŸ“š {{ _('ØªØ¹Ù„ÙŠÙ…','Education') }}</option>
      <option value="Ø¨ÙŠØ¦Ø©">ğŸŒ± {{ _('Ø¨ÙŠØ¦Ø©','Environment') }}</option>
      <option value="ØµØ­Ø©">ğŸ©º {{ _('ØµØ­Ø©','Health') }}</option>
      <option value="Ø¥Ø¨Ø¯Ø§Ø¹">ğŸ¨ {{ _('Ø¥Ø¨Ø¯Ø§Ø¹','Creativity') }}</option>
    </select>

    <label class="form-label">{{ _('Ø±ÙØ¹ ØµÙˆØ±Ø©','Upload Image') }}</label>
    <input type="file" name="image" class="form-control mb-3" id="imageInput">
    <div class="mb-3">
      <img id="preview" src="#" alt="preview" class="img-fluid rounded d-none" style="max-height:200px;">
    </div>

    <button class="btn btn-primary w-100 fw-bold">{{ _('Ø¥Ø¶Ø§ÙØ© ÙÙƒØ±Ø©','Add Idea') }}</button>
  </form>
</div>

<script>
const imageInput = document.getElementById('imageInput');
const preview = document.getElementById('preview');
imageInput.addEventListener('change', function(){
  const file = this.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      preview.src = e.target.result;
      preview.classList.remove('d-none');
    }
    reader.readAsDataURL(file);
  }
});

const descInput = document.getElementById('descInput');
const charCount = document.getElementById('charCount');
descInput.addEventListener('input', function(){
  charCount.textContent = `${this.value.length} / 300`;
});
</script>
{% endif %}

<div class="row g-4">
{% for idea in ideas %}
<div class="col-md-6">
  <div class="card shadow-sm">
    {% if idea.image %}
    <img src="{{ url_for('static', filename='images/' + idea.image) }}" class="card-img-top">
    {% endif %}
    <div class="card-body">
      <h5 class="card-title fw-bold">{{ idea.title }}</h5>
      <p class="card-text">{{ idea.description }}</p>
      {% if idea.category %}
      <span class="badge bg-info">{{ idea.category }}</span>
      {% endif %}
      <div class="mt-3 d-flex flex-wrap gap-2">
        <form action="{{ url_for('vote', idea_id=idea.id) }}" method="post" style="display:inline;">
          <button class="btn btn-success btn-sm">ğŸ‘ {{ idea.votes }}</button>
        </form>
        <form action="{{ url_for('downvote', idea_id=idea.id) }}" method="post" style="display:inline;">
          <button class="btn btn-danger btn-sm">ğŸ‘ {{ idea.downvotes }}</button>
        </form>
        <a href="{{ url_for('idea_detail', idea_id=idea.id) }}" class="btn btn-outline-primary btn-sm">ğŸ’¬ {{ _('Ø§Ù„ØªÙØ§ØµÙŠÙ„','Details') }}</a>
        {% if session.get('user_id') == idea.submitter_id or session.get('role') == 'admin' %}
        <form action="{{ url_for('delete_idea', idea_id=idea.id) }}" method="post" 
              onsubmit="return confirm('{{ _('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ','Are you sure?') }}');" style="display:inline;">
          <button class="btn btn-outline-danger btn-sm">ğŸ—‘</button>
        </form>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endfor %}
</div>
{% endblock %}










